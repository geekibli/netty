# 亿级架构核心：流量架构


根据之前的二八定律和冗余系数，假设1亿用户，大概知道了高峰期每秒可能会有10万的qps之后，来看一下系统中各层组件的部署架构。

## 各组件的并发能力基线值

1. Nginx: 一个高性能的Web-Server和实施反向代理的软件
2. LVS: linux virtual srever, 使用集群技术，实现在linux操作系统层面的一个高性能，高可用，负载均衡服务器
3. Keepalived: 一款用来检测服务状态存活的软件，常用来做高可用
4. F5:一个高性能，高可用，负载均衡的硬件设备
5. DNS轮询：通过在DNS-Server上对一个域名设置多个IP解析，来扩充Web-Server性能实施负载均衡的技术


## Tomcat

tomcat默认配置的最大请求数是150，也就是说同时支持150个并发。

具体能承载多少并发，需要看硬件的配置，CPU越多性能越高，分配给JVM的内存越多，性能也就会越高，但是会增加GC的负担，当某个应用拥有250个以上的并发的时候，应考虑应用服务器的集群。

## Nginx

官方的数据是5W的并发量。

1. Nginx只对请求进行转发和响应的转发，而没有进行业务逻辑的处理，大部分时间花在与其他计算的IO上。
2. Nginx的IO模型采用的是单线程或者是少线程，异步非阻塞的模式。（Tomcat是一个连接一个线程，同步阻塞的模式），避免了打开IO通道等待数据传输的过程（仅仅是在数据传到了，再来接受即可），极大的缩短了线程调度和IO处理时间。