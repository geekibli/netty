# 亿级架构核心：流量如何预估

根据二八定律，做出系统在不同用户量，不同场景下的流量（吞吐量）预估，含未来一段时间（比如2年）。

## 二八定律

**什么是二八定律？**

在任何一个食物中，最重要的只占其中的一小部分，大约20%，其余的80%是一大部分，却是次要的。

### 二八定律有哪些使用场景呢

#### 软件测试

80%的测试成本花费在20%的软件模块中。换句话说，就是80%的bug发生在20%的模块中。

#### 经济学场景

世界上80%的财富集中在20%的人手中。

#### 心理学场景

人类80%的智慧集中在20%的人身上。

#### 互联网场景

一个网站有成千上万的用户，但是80%的请求都是发生在20%的时间段内，比如，大家去网上购物，基本也都集中到中午休息或者晚上下班后。

二八定律的核心原则是关注重要的部分，忽略次要的部分。系统性能如果能支撑在20%时间内的高并发请求，必然也能支持非高峰时期的访问。

### 二八定律来计算逾期指标

#### 通过用户量来预估QPS

首先先预估系统的每日总请求数，这个没有固定的方法，如果没有任何历史数据参考，一般是通过用户量或者其他关联系统来评估。

**术语说明：**

QPS = req/sec = 请求数/秒

【通过用户量来推PV】

公式： （用户总数 * 20%）* 每天大致点击次数（淘宝经验30-50次）= pv数

问： 用户数是1000万，pv量是所少？
答： 1000万 * 20% 30 = 6000万

【pv推算QPS的公示】

公式： （总pv数 * 80%）/ （每天秒数 * 20%） = 峰值时间每秒请求数

问： 每天pv6000万，多少qps
答： (6000万 * 0.8) / (86400 * 0.2) = 2700


【加上冗余系数】

评估出来指标后，为了更加保险一些，最好在乘以一个冗余系数（偏离系数）,提高预期指标，防止任务评估造成预期指标偏低的情况。


这个冗余系数一般定义在2-5之间（行业经验）。上面计算出来的tps指标为2700，如果在乘以一个冗余系数4，那么最终的tps指标就定为10800。

**总结一下，二八定律的算法为 80%的请求/20%的时间*冗余系数**


1. 10万级用户量的压力预估大概在100的qps
2. 100万级用户量的压力预估大概在1000的qps

这只是预估出来的数据，和真实的数据是有一定的偏差的，这个偏差可以通过冗余系数来进行矫正。




