# 75 亿级架构核心：系统分层之_亿级流量分层过滤模型



## 直筒型请求过滤模型


直筒型是指用户请求1:1洞穿到DB层

客户端 -》 接入层 -〉 服务层 -》 缓存层 -〉 数据层

**这种请求过滤模型的特点：**

- 用户规模较小
- 请求峰值和平均值相差不大
- 请求峰值不会超过数据层的处理能力




## 漏斗形过滤模型

漏斗形业务，指的是从客户端到数据库层，请求的数量层层递减，递减的程度由具体的业务决定的。比如10w人抢购100个商品，那么db层的请求处理就是100个。


<img src="https://oscimg.oschina.net/oscnet/up-dd1027cbf8fe131d7e99781b6318e05e499.png" width=500 height=480>


比较适用的业务场景，比如，秒杀。

**特点：**

- 用户规模大
- 请求峰值和平均值相差较大
- 请求峰值远远超出最后一层，也就是数据库层的梳理能力

漏斗模型过滤的核心策略，还是**分层过滤**

CDN -> Nginx -> 服务网管 -> 缓存 -> 数据库


### 结合秒杀案例说明漏斗模型

比如，在秒杀系统中，请求分别通过，CDN, Nginx(商品详情)， 微服务，和数据库层： 

- CDN: 这一层可以返回大量的静态资源

- Nginx: 可以使用Nginx Cache，还可以对一些黑名单的请求和IP 或者用户，进行拦截

- 网关：接口权限校验，没有权限的直接返回，这一层面还可以设置限流策略。

- 业务层：进行数据的有效性，一致性过滤，会过滤掉一部分流量


经过上面几层过滤，真正到达数据库层面的请求基本上认为是合法请求，或者有效请求。


## 分层过滤的基本原则
























